package ru.backendpro.encapsulation_2;

/**
 Автор: Денис Кивилёв
 Online-школа: Backend-pro.ru

 Описание: ДЕМО-КОД ДЛЯ ЛЕКЦИИ 4: ООП — ЧАСТЬ 3. ИНКАПСУЛЯЦИЯ

 Показываем на практике:
 
 БЛОК 1: Проблема без инкапсуляции
 - Публичные поля → можно установить некорректные значения
 - Нет контроля, нет валидации
 
 БЛОК 2: Решение через инкапсуляцию
 - Приватные поля + getter/setter
 - Валидация в setter'ах
 - Контроль доступа

 БЛОК 3: Гибкость изменения реализации
 - Меняем внутреннюю реализацию без изменения API
 - Пример: double → BigDecimal для точности
 
 */
public class EncapsulationDemo {

    public static void main(String[] args) {

        // ========================================
        // БЛОК 1: ПРОБЛЕМА БЕЗ ИНКАПСУЛЯЦИИ
        // ========================================

        // ПЛОХОЙ ПРИМЕР: публичные поля

        // Создаём счёт БЕЗ инкапсуляции:
        BadAccount badAccount = new BadAccount();
        badAccount.accountNumber = "ACC-001";
        badAccount.balance = 1000.0; // Начальный баланс: 1000.0

        // ПРОБЛЕМЫ:
        // 1. Можно установить отрицательный баланс:
        badAccount.balance = -5000.0; // Никто не мешает!
        // badAccount.balance = -5000.0 ← НЕКОРРЕКТНО!

        // 2. Можно установить любое значение без валидации:
        badAccount.balance = 999999999.99;
        // badAccount.balance = 999999999.99 ← Нет контроля!

        // 3. Нельзя изменить внутреннюю реализацию:
        // Если захотим изменить тип с double на BigDecimal,
        // весь код клиентов сломается!

        // ========================================
        // БЛОК 2: РЕШЕНИЕ ЧЕРЕЗ ИНКАПСУЛЯЦИЮ
        // ========================================

        // ХОРОШИЙ ПРИМЕР: приватные поля + getter/setter

        // Создаём счёт С инкапсуляцией:
        GoodAccount goodAccount = new GoodAccount("ACC-002", 1000.0); // Начальный баланс: 1000.0

        // Пополняем счёт. Пополнение на 500.0 руб. Баланс: 1500.0
        goodAccount.deposit(500.0);

        // Снимаем средства. Снятие 300.0 руб. Баланс: 1200.0
        goodAccount.withdraw(300.0);

        // Попытка установить отрицательный баланс:
        try {
            // goodAccount.balance = -100; // Ошибка компиляции! Поле private

            // Вместо этого используем метод, который проверяет данные
            goodAccount.withdraw(10000.0); // Попытка снять больше, чем есть
        } catch (IllegalArgumentException e) {
            System.out.println("✓ ЗАЩИТА СРАБОТАЛА: Недостаточно средств. Баланс: 1200.0, запрошено: 10000.0");
        }

        /* ПРЕИМУЩЕСТВА ИНКАПСУЛЯЦИИ:
         1. Защита данных — нельзя установить некорректное значение
         2. Валидация — проверка в setter'ах и методах
         3. Контроль — все изменения проходят через методы
         4. Гибкость — можно изменить реализацию без изменения API
        */

        // ========================================
        // БЛОК 3: ГИБКОСТЬ ИЗМЕНЕНИЯ РЕАЛИЗАЦИИ
        // ========================================

        // Сценарий: Изменение внутренней реализации без изменения API

        // Версия 1: Хранение баланса как double
        AccountV1 accountV1 = new AccountV1(1000.0);
        accountV1.deposit(0.1);
        accountV1.deposit(0.1);
        accountV1.deposit(0.1);
        System.out.println(accountV1.getBalance()); // Баланс: 1000.3
        // ↑ Может быть неточность из-за double (например, 1000.30000000000001)

        // Версия 2: Изменили на BigDecimal для точности (внутри класса)
        AccountV2 accountV2 = new AccountV2(1000.0);
        accountV2.deposit(0.1);
        accountV2.deposit(0.1);
        accountV2.deposit(0.1);
        System.out.println(accountV2.getBalance()); // Баланс: 1000.3
        // ↑ Точность сохранена!

        /*
         РЕЗУЛЬТАТ:
         ✓ Внутренняя реализация изменилась (double → BigDecimal)
         ✓ Внешний API остался прежним (getBalance(), deposit())
         ✓ Код клиентов НЕ нужно менять!

         БЕЗ ИНКАПСУЛЯЦИИ:
         ✗ Если бы balance было public, пришлось бы менять весь код клиентов
         ✗ account.balance += 0.1 → account.balance = account.balance.add(...)
        */


        /* ========================================
          КЛЮЧЕВЫЕ ВЫВОДЫ:
          1. ИНКАПСУЛЯЦИЯ = сокрытие реализации + контроль доступа
          2. Поля ВСЕГДА private, доступ через getter/setter
          3. Валидация в setter'ах защищает от некорректных данных
          4. Можно изменить реализацию без изменения API
          ========================================
         */
    }
}